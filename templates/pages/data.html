{% extends "base.html" %}
{% block content %}

<div class="card">
  <div class="card-header">Data downloads</div>
  <div class="card-body">
    <p class="edu-muted">
      Export raw waveforms for analysis. Use Spectrum JSON for quick visualization; for teaching and research, compute spectra in Python from raw CSV.
    </p>

    <h5>Quick download links</h5>
    <ul>
      <li>Waveform CSV (default SHZ, 10 s): <a href="/api/wave.csv">/api/wave.csv</a></li>
      <li>Waveform JSON (with parameters): <a href="/api/wave">/api/wave</a></li>
      <li>Spectrum JSON (visualization only): <a href="/api/spectrum">/api/spectrum</a></li>
    </ul>

    <h6>With parameters</h6>
    <ul class="edu-small">
      <li>Waveform CSV: <a href="/api/wave.csv?station=GTN34&amp;channel=SHZ&amp;window_s=10">/api/wave.csv?station=GTN34&amp;channel=SHZ&ampMust;window_s=10</a></li>
      <li>Waveform JSON: <a href="/api/wave?station=GTN34&amp;channel=SHZ&amp;window_s=10">/api/wave?station=GTN34&amp;channel=SHZ&amp;window_s=10</a></li>
      <li>Spectrum JSON: <a href="/api/spectrum?station=GTN34&amp;channel=SHZ&amp;window_s=10&amp;fmax=50">/api/spectrum?station=GTN34&amp;channel=SHZ&amp;window_s=10&amp;fmax=50</a></li>
    </ul>

    <hr>

    <h5>Fields</h5>
    <ul class="edu-small">
      <li>Waveform JSON: time_s (seconds), wave (amplitude), fs (Hz), station, channel</li>
      <li>Waveform CSV: t_s, x</li>
      <li>Spectrum JSON: freq_hz, mag, dominant_hz, fs, window_s</li>
    </ul>

    <h5>Python starter (compute spectrum from raw CSV)</h5>
    <pre class="edu-small"><code>import pandas as pd
import numpy as np

# Download raw waveform
wave = pd.read_csv("http://127.0.0.1:8050/api/wave.csv?station=GTN34&channel=SHZ&window_s=10")  # t_s, x

# Derive sampling rate fs and window length T
t = wave["t_s"].to_numpy()
x = wave["x"].to_numpy()
dt = np.mean(np.diff(t))
fs = 1.0 / dt
T = t[-1] - t[0]
df = 1.0 / T  # frequency resolution

# Compute single-sided magnitude spectrum up to Nyquist
N = len(x)
X = np.fft.rfft(x)      # real FFT
f = np.fft.rfftfreq(N, d=dt)
mag = np.abs(X)

# Save or plot
spec = pd.DataFrame({"f_hz": f, "mag": mag})
spec.to_csv("spectrum_from_wave.csv", index=False)
print("fs =", fs, "Hz; T =", T, "s; df =", df, "Hz")</code></pre>

    <p class="edu-muted edu-small">
      Key parameters: sampling rate $f_s$, window $T$, Nyquist $f_N = \frac{f_s}{2}$, resolution $\Delta f = \frac{1}{T}$.
      Keep $f_s$ and $T$ consistent across comparisons and record environment context.
    </p>

    <h6>Command-line examples</h6>
    <pre class="edu-small"><code># Download raw waveform
curl -o wave.csv "http://127.0.0.1:8050/api/wave.csv?station=GTN34&channel=SHZ&window_s=10"

# Inspect JSON
curl -s "http://127.0.0.1:8050/api/wave?station=GTN34&channel=SHZ&window_s=10" | jq .

# Spectrum JSON for visualization
curl -s "http://127.0.0.1:8050/api/spectrum?station=GTN34&channel=SHZ&window_s=10&fmax=50" | jq .</code></pre>
  </div>
</div>

{% endblock %}